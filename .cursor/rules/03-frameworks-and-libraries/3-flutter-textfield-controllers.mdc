---
description: APPLIQUER cette architecture LORS de la création de TextFields dans des formulaires
globs: apps/*/lib/pages/**/widgets/text_*_input.dart, apps/*/lib/pages/**/widgets/textarea_*_input.dart
alwaysApply: true
---

Architecture obligatoire pour TextFields:

- StatefulWidget avec contrôleur géré dans initState/dispose
- BlocConsumer pour synchronisation bidirectionnelle
- Variable finale pour le contrôleur
- Synchronisation contrôleur ↔ state

Structure obligatoire:

```dart
class MonTextFieldInput extends StatefulWidget {
  @override
  State<MonTextFieldInput> createState() => _MonTextFieldInputState();
}

class _MonTextFieldInputState extends State<MonTextFieldInput> {
  final TextEditingController _controller = TextEditingController();

  @override
  void initState() {
    super.initState();
    _controller.text = context.read<MonBloc>().state.monChamp.value;
  }

  @override
  void dispose() {
    _controller.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return BlocConsumer<MonBloc, MonState>(
      listener: (context, state) {
        if (_controller.text != state.monChamp.value) {
          _controller.text = state.monChamp.value;
        }
      },
      builder: (context, state) {
        return TextField(
          controller: _controller,
          onChanged: (value) {
            context.read<MonBloc>().add(MonChampModifie(value));
          },
          // ... reste du widget
        );
      },
    );
  }
}
```

Règles strictes:

- JAMAIS initialiser le contrôleur directement dans le TextField
- TOUJOURS utiliser une variable finale pour le contrôleur
- OBLIGATOIRE : initState() pour initialiser, dispose() pour libérer
- OBLIGATOIRE : BlocConsumer (pas BlocBuilder seul)
- OBLIGATOIRE : Synchronisation dans le listener

Bonnes pratiques:

- Vérifier si le texte a changé avant de mettre à jour le contrôleur
- Gérer les erreurs de parsing dans le listener
- Utiliser des constantes pour les propriétés du TextField
- Tester la synchronisation dans les deux sens
